<div class="card">
  <h2>Question Management</h2>

  <div class="header-controls">
    <div class="control-group">
      <label for="courseSelect">Select Course:</label>
      <select
        id="courseSelect"
        [(ngModel)]="selectedCourseName"
        (change)="onCourseChange(selectedCourseName)">
        <option value="" disabled selected>Select a course</option>
        <option *ngFor="let course of courses" [value]="course.name">
          {{ course.name }}
        </option>
      </select>
    </div>

    <div class="control-group">
      <label>Filter (Difficulty):</label>
      <select [(ngModel)]="filterDifficulty" (change)="onDifficultyChange(filterDifficulty)">
        <option value="" disabled selected>Select difficulty</option>
        <option>Beginner</option>
        <option>Intermediate</option>
        <option>Advanced</option>
      </select>
    </div>

    <button class="btn add-btn dummy-btn" (click)="addQuestion()" [disabled]="isAddDisabled()">
      Add New Question
    </button>
  </div>

  <div class="table-container">
    <ng-container *ngIf="getFilteredQuestions().length > 0; else noQuestions">
      <table>
        <thead>
          <tr>
            <th>Question</th>
            <th>Difficulty</th>
            <th>Correct Answer</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let question of getFilteredQuestions()">
            <td>
              <span class="question">{{ question.text }}</span>

              <ul class="options-list">
                <li *ngFor="let opt of question.options; let i = index">
                  {{ getCharFromIndex(i) }}. {{ opt }}
                </li>
              </ul>
            </td>
            <td>
              <span class="difficulty-badge difficulty-{{ question.difficulty.toLowerCase() }}">
                {{ question.difficulty }}
              </span>
            </td>
            <td>
              Correct Answer:<br />
              <hr />
              {{ question.correctAnswer }}
            </td>
            <td class="action-buttons">
              <button class="btn edit-btn" (click)="editQuestion(question)">Edit</button>
              <button class="btn delete-btn" (click)="deleteQuestion(question.id)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </ng-container>

    <ng-template #noQuestions>
      <div class="no-questions-caution">
        <p *ngIf="selectedCourseName && filterDifficulty">
          There are currently no questions for the <strong>{{ selectedCourseName }}</strong> course
          at <strong>{{ filterDifficulty }}</strong> difficulty. <br />Click the button below to add
          the first question!
        </p>
        <p *ngIf="!selectedCourseName || !filterDifficulty">
          Please select both a course and difficulty to view questions.
        </p>
        <button class="btn add-btn" (click)="addQuestion()" [disabled]="isAddDisabled()">
          Add First Question
        </button>
      </div>
    </ng-template>
  </div>

  <div class="modal-overlay" *ngIf="isAddingModalOpen">
    <div class="modal">
      <h3>Add New Question</h3>
      <div class="form-group">
        <label>Question Text:</label>
        <input [(ngModel)]="newQuestionItem.text" />
      </div>
      

      <div class="form-group">
        <label>Options:</label>
        <input
          *ngFor="let opt of newQuestionItem.options; let i = index; trackBy: trackByOptions"
          [(ngModel)]="newQuestionItem.options[i]"
          placeholder="Option {{ getCharFromIndex(i) }}"
        />
      </div>

      <div class="form-group">
        <label>Correct Answer (Exact Text):</label>
        <input 
          type="text" 
          [(ngModel)]="correctAnswer"  placeholder="Enter the exact text of the correct option"/>
      </div>

      <div class="modal-buttons">
        <button class="btn save-btn" (click)="saveNewQuestion()">Save</button>
        <button class="btn cancel-btn" (click)="cancelAdd()">Cancel</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="editingQuestion">
    <div class="modal">
      <h3>{{ isAddingNew ? 'Add New Question' : 'Edit Question' }}</h3>

      <div class="form-group">
        <label>Question Text:</label>
        <input [(ngModel)]="editingQuestion.text" />
      </div>

      <div class="form-group">
        <label>Options:</label>
        <input
          *ngFor="let opt of editingQuestion.options; let i = index; trackBy: trackByOptions"
          [(ngModel)]="editingQuestion.options[i]"
          placeholder="Option {{ getCharFromIndex(i) }}"
        />
      </div>

      <div class="form-group">
        <label>Correct Answer (Exact Text):</label>
        <input 
          type="text" 
          [(ngModel)]="editingQuestion.correctAnswer" placeholder="Enter the exact text of the correct option"/>
      </div>

      <div class="modal-buttons">
        <button class="btn save-btn" (click)="saveQuestion()">Save</button>
        <button class="btn cancel-btn" (click)="cancelEdit()">Cancel</button>
      </div>
    </div>
  </div>
</div>